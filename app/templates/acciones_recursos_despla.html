<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>SISGEM - Desplegar Recursos</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#005A9C",
            "secondary": "#2E7D32",
            "accent": "#FF8F00",
            "background-light": "#F4F6F8",
            "background-dark": "#212529",
            "text-light-primary": "#212529",
            "text-light-secondary": "#6C757D",
            "text-dark-primary": "#F4F6F8",
            "text-dark-secondary": "#6C757D",
          },
          fontFamily: {
            "display": ["Manrope", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    
    .recurso-card {
      transition: all 0.2s ease;
    }
    
    .recurso-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .recurso-card.selected {
      border-color: #005A9C;
      background-color: rgba(0, 90, 156, 0.05);
    }
    
    .form-select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">
  <!-- Hidden input para almacenar el ID de la emergencia -->
  <input type="hidden" id="emergencia-id" value="{{ emergencia_id }}" />
  
  <div class="relative flex min-h-screen w-full flex-col">
    <header
      class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center gap-4 text-text-light-primary dark:text-text-dark-primary">
            <span class="material-symbols-outlined text-primary text-3xl">emergency_home</span>
            <h2 class="text-lg font-bold">SISGEM</h2>
          </div>
          <nav class="hidden md:flex flex-1 justify-center items-center gap-8">
            <a class="text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary hover:text-primary transition-colors"
              href="{{ url_for('auth.inicio') }}">Inicio</a>
            <a class="text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary hover:text-primary transition-colors"
              href="#">Registro</a>
            <a class="text-sm font-bold text-primary border-b-2 border-primary" href="#">Desplegar Recursos</a>
          </nav>
          <div class="flex items-center relative">
            <button id="user-menu-button" aria-haspopup="true" aria-expanded="false" 
              class="w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-primary">
              <span class="material-symbols-outlined text-text-light-primary dark:text-text-dark-primary">person</span>
            </button>
            <div id="user-menu" class="hidden absolute right-0 top-12 z-20 w-44 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-lg py-1">
              <div class="px-4 py-2 text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Cuenta</div>
              <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span class="material-symbols-outlined text-base">logout</span>
                Salir
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
        <div>
          <h1 class="text-text-light-primary dark:text-text-dark-primary text-4xl font-black tracking-tight">
            Desplegar Recursos
          </h1>
          <p class="mt-2 text-base text-text-light-secondary dark:text-text-dark-secondary">
            Seleccione los recursos a desplegar para atender la emergencia
          </p>
        </div>
        <div class="flex items-center gap-2 text-sm">
          <span class="material-symbols-outlined text-primary">info</span>
          <span class="text-text-light-secondary dark:text-text-dark-secondary">
            <span id="recursos-seleccionados-count">0</span> recursos seleccionados
          </span>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Sección de Bomberos -->
        <div class="lg:col-span-1 space-y-6">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary flex items-center gap-2">
                <span class="material-symbols-outlined text-secondary">local_fire_department</span>
                Bomberos Disponibles
              </h2>
              <button id="btn-seleccionar-todos-bomberos" 
                class="text-xs font-semibold text-primary hover:text-primary/80 transition-colors">
                Seleccionar todos
              </button>
            </div>
            
            <div class="relative mb-4">
              <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-light-secondary dark:text-text-dark-secondary">search</span>
              <input id="buscar-bomberos"
                class="form-input w-full rounded-lg border-gray-300 dark:border-gray-600 bg-background-light dark:bg-gray-700 text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary focus:ring-primary focus:border-primary pl-10"
                placeholder="Buscar estación..." type="text" />
            </div>

            <div id="lista-bomberos" class="flex flex-col gap-3 max-h-96 overflow-y-auto">
              <div class="text-center py-8 text-text-light-secondary">
                <span class="material-symbols-outlined text-4xl">local_fire_department</span>
                <p class="mt-2">Cargando bomberos...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Sección de Hidrantes -->
        <div class="lg:col-span-1 space-y-6">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary flex items-center gap-2">
                <span class="material-symbols-outlined text-blue-600">water_drop</span>
                Hidrantes Disponibles
              </h2>
              <button id="btn-seleccionar-todos-hidrantes" 
                class="text-xs font-semibold text-primary hover:text-primary/80 transition-colors">
                Seleccionar todos
              </button>
            </div>
            
            <div class="relative mb-4">
              <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-light-secondary dark:text-text-dark-secondary">search</span>
              <input id="buscar-hidrantes"
                class="form-input w-full rounded-lg border-gray-300 dark:border-gray-600 bg-background-light dark:bg-gray-700 text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary focus:ring-primary focus:border-primary pl-10"
                placeholder="Buscar hidrante..." type="text" />
            </div>

            <div id="lista-hidrantes" class="flex flex-col gap-3 max-h-96 overflow-y-auto">
              <div class="text-center py-8 text-text-light-secondary">
                <span class="material-symbols-outlined text-4xl">water_drop</span>
                <p class="mt-2">Cargando hidrantes...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Sección de Resumen y Acciones -->
        <div class="lg:col-span-1 space-y-6">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 sticky top-24">
            <h2 class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-accent">assignment</span>
              Resumen de Despliegue
            </h2>

            <!-- Resumen de recursos seleccionados -->
            <div class="space-y-4 mb-6">
              <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-secondary">local_fire_department</span>
                  <span class="font-medium text-sm text-text-light-primary dark:text-text-dark-primary">Bomberos</span>
                </div>
                <span id="count-bomberos" class="font-bold text-lg text-secondary">0</span>
              </div>

              <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-blue-600">water_drop</span>
                  <span class="font-medium text-sm text-text-light-primary dark:text-text-dark-primary">Hidrantes</span>
                </div>
                <span id="count-hidrantes" class="font-bold text-lg text-blue-600">0</span>
              </div>
            </div>

            <!-- Formulario de acciones -->
            <form id="form-despliegue" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2" 
                  for="acciones-realizadas">
                  Acciones a realizar
                </label>
                <textarea
                  id="acciones-realizadas"
                  class="form-textarea w-full rounded-lg border-gray-300 dark:border-gray-600 bg-background-light dark:bg-gray-700 text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary focus:ring-primary focus:border-primary"
                  rows="3"
                  placeholder="Describa las acciones a realizar..."
                  required></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2" 
                  for="observaciones">
                  Observaciones
                </label>
                <textarea
                  id="observaciones"
                  class="form-textarea w-full rounded-lg border-gray-300 dark:border-gray-600 bg-background-light dark:bg-gray-700 text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary focus:ring-primary focus:border-primary"
                  rows="3"
                  placeholder="Observaciones adicionales..."></textarea>
              </div>

              <!-- Botones de acción -->
              <div class="space-y-3 pt-4">
                <button
                  type="submit"
                  class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  id="btn-desplegar">
                  <span class="material-symbols-outlined">send</span>
                  Desplegar Recursos
                </button>

                <button
                  type="button"
                  class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-text-light-primary dark:text-text-dark-primary font-semibold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                  onclick="window.history.back()">
                  <span class="material-symbols-outlined">arrow_back</span>
                  Volver a Identificar
                </button>
              </div>
            </form>

            <!-- Indicador de carga -->
            <div id="spinner-despliegue" class="hidden mt-4 flex flex-col items-center gap-2">
              <div class="animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent"></div>
              <p class="text-sm text-text-light-secondary">Desplegando recursos...</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Script para el menú de usuario
    (function(){
      const btn = document.getElementById('user-menu-button');
      const menu = document.getElementById('user-menu');
      if(!btn || !menu) return;
      function closeMenu(){ menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }
      function toggleMenu(){
        const open = menu.classList.contains('hidden');
        if(open){ menu.classList.remove('hidden'); btn.setAttribute('aria-expanded','true'); }
        else { closeMenu(); }
      }
      btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleMenu(); });
      document.addEventListener('click', (e)=>{ if(!menu.contains(e.target) && e.target !== btn){ closeMenu(); }});
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeMenu(); });
    })();
  </script>
  <script src="{{ url_for('static', filename='js/desplegar_recursos.js') }}"></script>
</body>

</html>